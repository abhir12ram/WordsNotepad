<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìò Word Notepad</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ------------------ OPTIMIZED CLEAN CSS ------------------ */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #F5F7FA;
      margin: 0;
      padding: 20px;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 550px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    h2 {
      text-align: center;
      color: #4A90E2;
      font-size: 26px;
      margin-bottom: 20px;
      font-weight: 700;
    }

    input, textarea, button {
      width: 100%;
      padding: 12px 15px;
      margin-top: 10px;
      margin-bottom: 10px;
      border: 1px solid #DDE4E9;
      border-radius: 10px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'Open Sans', sans-serif;
    }

    input:focus, textarea:focus {
      border-color: #4A90E2;
      box-shadow: 0 0 0 3px rgba(74,144,226,0.2);
    }

    button {
      background-color: #4A90E2;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    button:hover {
      background-color: #357ABD;
      box-shadow: 0 4px 10px rgba(74,144,226,0.3);
      transform: translateY(-1px);
    }

    #toggleFeaturesBtn {
      background-color: #6C757D;
    }

    #toggleFeaturesBtn:hover {
      background-color: #5A6268;
    }

    .date-group {
      background: #EAF3FC;
      border: 1px solid #C4DFFB;
      border-radius: 14px;
      padding: 15px;
      margin-top: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.07);
    }

    .date-header {
      font-weight: 700;
      color: #2F5F8F;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-btns {
      display: flex;
      gap: 8px;
    }

    .toggle-btn, .delete-btn, .select-all-btn {
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: .3s;
    }

    .toggle-btn { background: #4A90E2; color: #fff; }
    .toggle-btn:hover { background: #357ABD; }

    .select-all-btn { background: #28A745; color: #fff; }
    .select-all-btn:hover { background: #218838; }

    .delete-btn { background: #DC3545; color: #fff; }
    .delete-btn:hover { background: #C82333; }

    .word-item {
      background: #fff;
      border: 1px solid #E0E6EB;
      border-left: 5px solid #4A90E2;
      padding: 12px 15px;
      border-radius: 12px;
      margin-top: 12px;
      display: flex;
      gap: 12px;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      transition: .2s;
    }

    .word-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }

    .word-title { font-weight: 700; font-size: 17px; }
    .word-meaning { font-size: 14px; color: #666; }

    .word-container {
      overflow: hidden;
      transition: max-height .4s ease, opacity .4s ease;
    }

    .collapsed { max-height: 0 !important; opacity: 0; }

    input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: #4A90E2;
    }

    .hidden { display: none; }

  </style>
</head>
<body>

  <div class="container">
    <h2>üìò Word Notepad</h2>

    <!-- Add Section -->
    <div id="add-section">
      <input type="text" id="word" placeholder="Enter new word...">
      <textarea id="meaning" placeholder="Enter meaning or notes..."></textarea>

      <label for="wordDate">üìÖ Choose Date:</label>
      <input type="date" id="wordDate">

      <button id="saveBtn">üíæ Save Word</button>
    </div>

    <button id="toggleFeaturesBtn">Show More Options ‚öôÔ∏è</button>

    <!-- Extra Features -->
    <div id="extra-features" class="hidden">
      <label for="filterDate">üìÖ Filter by Date:</label>
      <input type="date" id="filterDate">
      <button id="filterBtn">Filter</button>

      <h3>üìö All Saved Words</h3>
      <div id="wordList"></div>

      <button id="shareBtn" class="hidden">üì§ Share Selected</button>
    </div>
  </div>

<script>
let wordToDelete = null;

document.addEventListener("DOMContentLoaded", () => {
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("wordDate").value = today;
  document.getElementById("filterDate").value = today;
  loadWords();
});

//----------------------------------------
// ‚úÖ SAVE TO SHEETDB
//----------------------------------------
async function saveWord() {
  const word = document.getElementById("word").value.trim();
  const meaning = document.getElementById("meaning").value.trim();
  const date = document.getElementById("wordDate").value;

  if (!word || !meaning) {
    alert("Please enter both word and meaning!");
    return;
  }

  const id = Date.now();

  const data = {
    data: [
      { word, meaning, date, id }
    ]
  };

  try {
    await fetch("https://sheetdb.io/api/v1/owzpi949b6buz", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    document.getElementById("word").value = "";
    document.getElementById("meaning").value = "";
    loadWords();
    alert("‚úÖ Word saved successfully!");
  } catch (err) {
    alert("‚ùå Error saving to SheetDB");
  }
}

//----------------------------------------
// ‚úÖ LOAD FROM SHEETDB
//----------------------------------------
async function loadWords(filterDate = "") {
  const wordList = document.getElementById("wordList");
  wordList.innerHTML = "";

  let words = [];

  try {
    const response = await fetch("https://sheetdb.io/api/v1/owzpi949b6buz");
    words = await response.json();
  } catch (err) {
    alert("‚ùå Error loading data from SheetDB");
    return;
  }

  if (filterDate) {
    words = words.filter(w => w.date === filterDate);
  }

  const grouped = {};
  words.forEach(w => {
    if (!grouped[w.date]) grouped[w.date] = [];
    grouped[w.date].push(w);
  });

  const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

  sortedDates.forEach(date => {
    const groupDiv = document.createElement("div");
    groupDiv.classList.add("date-group");

    const header = document.createElement("div");
    header.classList.add("date-header");
    header.innerHTML = `üìÖ ${date}`;

    const headerBtns = document.createElement("div");
    headerBtns.classList.add("header-btns");

    const selectAllBtn = document.createElement("button");
    selectAllBtn.textContent = "‚úî";
    selectAllBtn.classList.add("select-all-btn");
    selectAllBtn.onclick = (e) => {
      e.stopPropagation();
      toggleSelectAll(groupDiv);
    };

    const toggleBtn = document.createElement("button");
    toggleBtn.textContent = "‚ñº";
    toggleBtn.classList.add("toggle-btn");

    const wordContainer = document.createElement("div");
    wordContainer.classList.add("word-container");
    wordContainer.style.maxHeight = "1000px";

    toggleBtn.onclick = (e) => {
      e.stopPropagation();
      const isCollapsed = wordContainer.classList.toggle("collapsed");

      if (!isCollapsed) {
        wordContainer.style.maxHeight = wordContainer.scrollHeight + "px";
        toggleBtn.textContent = "‚ñº";
      } else {
        wordContainer.style.maxHeight = wordContainer.scrollHeight + "px";
        wordContainer.offsetHeight;
        wordContainer.style.maxHeight = "0";
        toggleBtn.textContent = "‚ñ∂";
      }

      toggleShareButton();
    };

    headerBtns.appendChild(selectAllBtn);
    headerBtns.appendChild(toggleBtn);
    header.appendChild(headerBtns);
    groupDiv.appendChild(header);

    grouped[date].forEach(item => {
      const div = document.createElement("div");
      div.classList.add("word-item");
      div.dataset.id = item.id;

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = `${item.word}: ${item.meaning}`;
      checkbox.dataset.id = item.id;
      checkbox.onchange = toggleShareButton;

      const info = document.createElement("div");
      info.classList.add("word-info");

      const title = document.createElement("div");
      title.classList.add("word-title");
      title.textContent = item.word;

      const meaning = document.createElement("div");
      meaning.classList.add("word-meaning");
      meaning.textContent = item.meaning;

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóë";
      delBtn.classList.add("delete-btn");
      delBtn.onclick = () => showDeletePopup(item.word, item.date, item.id);

      info.appendChild(title);
      info.appendChild(meaning);

      div.appendChild(checkbox);
      div.appendChild(info);
      div.appendChild(delBtn);

      wordContainer.appendChild(div);
    });

    groupDiv.appendChild(wordContainer);
    wordList.appendChild(groupDiv);

    wordContainer.style.maxHeight = wordContainer.scrollHeight + "px";
  });

  toggleShareButton();
}

//----------------------------------------
// ‚úÖ SELECT ALL CHECKBOXES IN A DATE GROUP
//----------------------------------------
function toggleSelectAll(groupDiv) {
  const checkboxes = groupDiv.querySelectorAll(".word-item input[type='checkbox']");
  const allChecked = Array.from(checkboxes).every(cb => cb.checked);

  checkboxes.forEach(cb => {
    cb.checked = !allChecked;
  });

  toggleShareButton();
}

//----------------------------------------
// ‚úÖ DELETE WORD (POPUP CONFIRM)
//----------------------------------------
function showDeletePopup(word, date, id) {
  wordToDelete = { word, date, id };
  document.getElementById("confirmText").textContent = `Delete word "${word}" from ${date}?`;
  document.getElementById("confirmPopup").style.display = "flex";
}

//----------------------------------------
// ‚úÖ DELETE FROM SHEETDB
//----------------------------------------
async function confirmDelete(confirm) {
  document.getElementById("confirmPopup").style.display = "none";

  if (!confirm || !wordToDelete) return;

  try {
    await fetch(`https://sheetdb.io/api/v1/owzpi949b6buz/id/${wordToDelete.id}`, {
      method: "DELETE"
    });

    const featuresHidden = document.getElementById("extra-features").classList.contains("hidden");
    const filterToApply = featuresHidden ? "" : document.getElementById("filterDate").value;

    loadWords(filterToApply);
    alert("üóëÔ∏è Word deleted successfully!");
  } catch (err) {
    alert("‚ùå Error deleting from SheetDB");
  }

  wordToDelete = null;
}

//----------------------------------------
// FILTER BY DATE
//----------------------------------------
function filterByDate() {
  loadWords(document.getElementById("filterDate").value);
}

//----------------------------------------
// SHOW/HIDE EXTRA OPTIONS
//----------------------------------------
function toggleFeatures() {
  const section = document.getElementById("extra-features");
  const btn = document.getElementById("toggleFeaturesBtn");
  section.classList.toggle("hidden");
  btn.textContent = section.classList.contains("hidden")
    ? "Show More Options ‚öôÔ∏è"
    : "Hide Options ‚ùå";
  loadWords();
}

//----------------------------------------
function toggleFloatingMenu() {
  const menu = document.getElementById("floatingMenu");
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}

//----------------------------------------
function toggleShareButton() {
  const checkboxes = document.querySelectorAll("#wordList input[type='checkbox']");
  const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
  document.getElementById("shareBtn").style.display = anyChecked ? "block" : "none";
}

//----------------------------------------
function shareSelected() {
  const checkboxes = document.querySelectorAll("#wordList input[type='checkbox']:checked");
  if (checkboxes.length === 0) {
    alert("Please select at least one word to share!");
    return;
  }

  const wordsData = Array.from(checkboxes).map(cb => {
    const [word, meaning] = cb.value.split(": ");
    const dateEl = cb.closest(".date-group").querySelector(".date-header");
    const date = dateEl ? dateEl.textContent.replace("üìÖ ", "").trim() : "Unknown Date";
    return `üìå ${word}\nüìù Meaning: ${meaning}\nüìÖ Date: ${date}`;
  });

  const formattedText = "üìò Word Notepad\n\n" + wordsData.join("\n\n");

  if (window.AndroidBridge && window.AndroidBridge.shareText) {
    window.AndroidBridge.shareText(formattedText);
  } else if (navigator.share) {
    navigator.share({ title: "My Word Notes", text: formattedText }).catch(() => {});
  } else {
    copyToClipboard(formattedText);
    alert("üìã Words copied to clipboard!");
  }
}

//----------------------------------------
function copyToClipboard(text) {
  const temp = document.createElement("textarea");
  temp.value = text;
  document.body.appendChild(temp);
  temp.select();
  document.execCommand("copy");
  document.body.removeChild(temp);
}
</script>

</body>
</html>
